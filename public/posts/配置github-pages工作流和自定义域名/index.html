<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  
  <title>配置Github Pages工作流和自定义域名 | Jaben Blog</title>
  <meta name="viewport" content="width=device-width,minimum-scale=1">
  <meta name="description"
    content="本文介绍为github pages配置自定构建工作流和自定义域名，尤其是自定义域名这个功能非常好用，当然这里面也花了蛮长时间设置的，尤其是DNS记录生效需要等待的时间比较长，印象深刻。">
  <meta name="generator" content="Hugo 0.115.1">
  
  
  
  
  <meta name="robots" content="noindex, nofollow">
  
  

  


  

  
  
<link rel="shortcut icon" href="/image/favicon.png" type="image/x-icon" />


  

  

  
  <link rel="canonical" href="https://jebben.cn/posts/%E9%85%8D%E7%BD%AEgithub-pages%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D/">
  
  
  
  <link rel="stylesheet" href="https://jebben.cn/custom.min.7f1191ba9dd6fb40bfbffa8dbb4e7daf4419ef992b4de5cd51531ec2dc79b1d0.css" integrity="sha256-fxGRup3W&#43;0C/v/qNu059r0QZ75krTeXNUVMewtx5sdA=" media="screen">
  
  <style>
    @font-face {
      font-family: "GoodHood";
      src: url("/font/GoodHood.otf");
    }
  </style>
  <meta property="og:title" content="配置Github Pages工作流和自定义域名" />
<meta property="og:description" content="本文介绍为github pages配置自定构建工作流和自定义域名，尤其是自定义域名这个功能非常好用，当然这里面也花了蛮长时间设置的，尤其是DNS记录生效需要等待的时间比较长，印象深刻。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jebben.cn/posts/%E9%85%8D%E7%BD%AEgithub-pages%E5%B7%A5%E4%BD%9C%E6%B5%81%E5%92%8C%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9F%9F%E5%90%8D/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-05-11T08:48:35+08:00" />
<meta property="article:modified_time" content="2024-05-11T08:48:35+08:00" />
<meta itemprop="name" content="配置Github Pages工作流和自定义域名">
<meta itemprop="description" content="本文介绍为github pages配置自定构建工作流和自定义域名，尤其是自定义域名这个功能非常好用，当然这里面也花了蛮长时间设置的，尤其是DNS记录生效需要等待的时间比较长，印象深刻。"><meta itemprop="datePublished" content="2024-05-11T08:48:35+08:00" />
<meta itemprop="dateModified" content="2024-05-11T08:48:35+08:00" />
<meta itemprop="wordCount" content="245">
<meta itemprop="keywords" content="Github pages,workflow," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="配置Github Pages工作流和自定义域名"/>
<meta name="twitter:description" content="本文介绍为github pages配置自定构建工作流和自定义域名，尤其是自定义域名这个功能非常好用，当然这里面也花了蛮长时间设置的，尤其是DNS记录生效需要等待的时间比较长，印象深刻。"/>

  
</head>

<body class="ma0 ">
  <div class="container">
    
   
  

<header class="cover bg-top" style="background-image: url('');">
  <div class="">
    <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    
    <a href="/" style="font-family:GoodHood;letter-spacing:2px;"
      class="f2 fw2 hover-white no-underline white-90 dib">
      
      Jaben Blog
      
    </a>
    
    <div class="flex-l items-center">
      

      
      <ul class="pl0 mr3">
        
        <li class="list f5 f5-ns fw4 dib pr3">
          <a class="hover-white no-underline white-90" href="/categories/website-design-notes/" title="">
            网页设计笔记
          </a>
        </li>
        
        <li class="list f5 f5-ns fw4 dib pr3">
          <a class="hover-white no-underline white-90" href="/categories/dev-notes/" title="">
            独立开发log
          </a>
        </li>
        
        <li class="list f5 f5-ns fw4 dib pr3">
          <a class="hover-white no-underline white-90" href="/" title="">
            我的作品
          </a>
        </li>
        
        <li class="list f5 f5-ns fw4 dib pr3">
          <a class="hover-white no-underline white-90" href="/" title="">
            关于作者
          </a>
        </li>
        
      </ul>
      
      
<div class="ananke-socials">
  
</div>

    </div>
  </div>
</nav>
  </div>
</header>

    <main class="pb7" role="main">
      
  
  <article class="post-article flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      
      










  <div id="sharing" class="mt3 ananke-socials">
    
  </div>


      <h1 class="f2 athelas mt3 mb1">配置Github Pages工作流和自定义域名</h1>
      
      
      
      <time class="f6 mv4 dib tracked" datetime="2024-05-11T08:48:35+08:00">五月 11, 2024</time>
      

      
      
    </header>
    <div class="article-body nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l"><p>最近基于Hugo框架做了静态个人网站，使用github pages，搭配cloudflare免费版计划提供的一键CDN加速。一天之内完成了设计+开发+部署。也遇到了一些小问题，在此记录一下问题的具体情况以及解决的方法。</p>
<h2 id="hugo端的配置">Hugo端的配置</h2>
<p>相关文档已经很细致，安装和其他的一些细节不在此赘述。</p>
<ul>
<li>
<p>首先，基于<code>ananke</code>主题进行了小范围的修改，我的做法是将theme作为git的子模块（submodule），然后将theme目录下的布局目录（layout）复制到根目录下，然后在这里进行布局的修改，避免直接修改主题的源代码（因为直接修改主题的源代码会带来变动，在git树下会看到额外仓库的改动非常不舒服）。</p>
</li>
<li>
<p>其次添加一些自定义的css和字体，用到了预处理语言<code>sass</code>(写起来会更舒服一点)，如何编译、处理（合并）<code>sass</code>文件并引入到博客里。</p>
</li>
</ul>
<p>引入样式：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!-- 这里的意思是 读取 /assets目录下的 子目录/css下的所有scss文件编译合并为custom.css，然后压缩印上指纹 --&gt;</span>
</span></span><span style="display:flex;"><span>{{ $style := resources.Match &#34;css/**.scss&#34; | resources.Concat &#34;custom.css&#34; | toCSS | minify | fingerprint }}
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ $style.Permalink }}&#34;</span> <span style="color:#a6e22e">integrity</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{{ $style.Data.Integrity }}&#34;</span> <span style="color:#a6e22e">media</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;screen&#34;</span>&gt;
</span></span></code></pre></div><p>使用自定义字体:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>  &lt;<span style="color:#f92672">style</span>&gt;
</span></span><span style="display:flex;"><span>    @<span style="color:#66d9ef">font-face</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">font-family</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;GoodHood&#34;</span><span style="color:#f92672">;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">src</span><span style="color:#f92672">:</span> <span style="color:#f92672">url</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/font/GoodHood.otf&#34;</span><span style="color:#f92672">);</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">style</span>&gt;
</span></span></code></pre></div><p>如果需要引入<code>js</code>文件参考上述处理css文件的做法。</p>
<h2 id="github端的配置">Github端的配置</h2>
<p>首先增加一个workflow：<code>/.github/workflows/flow.yml</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yml" data-lang="yml"><span style="display:flex;"><span><span style="color:#75715e"># Sample workflow for building and deploying a Hugo site to GitHub Pages</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy Hugo site to Pages</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">on</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">push</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">branches</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ae81ff">main</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">workflow_dispatch</span>:
</span></span><span style="display:flex;"><span><span style="color:#f92672">permissions</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">contents</span>: <span style="color:#ae81ff">read</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">pages</span>: <span style="color:#ae81ff">write</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">id-token</span>: <span style="color:#ae81ff">write</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">concurrency</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#34;pages&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">cancel-in-progress</span>: <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">defaults</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">run</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">shell</span>: <span style="color:#ae81ff">bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">jobs</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Build job</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">build</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">HUGO_VERSION</span>: <span style="color:#ae81ff">0.115.1</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Hugo CLI</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          wget -O ${{ runner.temp }}/hugo.deb https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_extended_${HUGO_VERSION}_linux-amd64.deb \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &amp;&amp; sudo dpkg -i ${{ runner.temp }}/hugo.deb          </span>          
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Dart Sass</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#ae81ff">sudo snap install dart-sass</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Checkout</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/checkout@v3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">submodules</span>: <span style="color:#ae81ff">recursive</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">fetch-depth</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Setup Pages</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">pages</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/configure-pages@v3</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Install Node.js dependencies</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: <span style="color:#e6db74">&#34;[[ -f package-lock.json || -f npm-shrinkwrap.json ]] &amp;&amp; npm ci || true&#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build with Hugo</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">env</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#75715e"># For maximum backward compatibility with Hugo modules</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">HUGO_ENVIRONMENT</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">HUGO_ENV</span>: <span style="color:#ae81ff">production</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">run</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          hugo \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --gc \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --minify \
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            --baseURL &#34;${{ steps.pages.outputs.base_url }}/&#34;          </span>          
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Upload artifact</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/upload-pages-artifact@v1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">with</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">./public</span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e"># Deployment job</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">deploy</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">environment</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">name</span>: <span style="color:#ae81ff">github-pages</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">url</span>: <span style="color:#ae81ff">${{ steps.deployment.outputs.page_url }}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">runs-on</span>: <span style="color:#ae81ff">ubuntu-latest</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">needs</span>: <span style="color:#ae81ff">build</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">steps</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Deploy to GitHub Pages</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">id</span>: <span style="color:#ae81ff">deployment</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">uses</span>: <span style="color:#ae81ff">actions/deploy-pages@v2</span>
</span></span></code></pre></div><p>这样每次提交代码就能看到后续跟着一个action在执行了。</p>
<p>其次需要修改<code>Workflow permissions</code>,在路径<code>settings/Actions/General</code>下，设置为
这个配置：</p>
<p><img src="workflow-setting.png" alt="图片"></p>
<p>然后等待构建完成，打开<code>https://{username}.github.io/{registryname}/</code>即可访问博客了。</p>
<h2 id="配置自定义域名">配置自定义域名</h2>
<p>我这里选择增加两个DNS记录：A记录和CNAME记录。比如我要设置的域名是：jebben.cn;我的github用户名是anderlaw。</p>
<ul>
<li>A:@:185.199.111.153(githubIP)</li>
<li>CNAME:www.jebben.cn:anderlaw.github.io</li>
</ul>
<p>增加完毕后，一般至少需要等待几个小时，所以弄完明天再来看看github page页面上的域名检查是否正常，通过了就表示设置成功了。</p>
<span class="post-tags">
    <img src="/image/tags-fill.png" height="22px"/>
    <span><a class="color-inherit link" href="/tags/github-pages/">Github pages</a>,&nbsp;<a class="color-inherit link" href="/tags/workflow/">workflow</a></span>
  </span><div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class=" bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f5 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://jebben.cn/" >
    &copy;  Jaben Blog 2024 
  </a>
    <div>
<div class="ananke-socials">
  
</div>
</div>
  </div>
</footer>

  </div>
</body>

</html>